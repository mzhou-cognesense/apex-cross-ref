<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Part Cross‑Reference — OLD→NEW / NEW→OLD</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#0b1220; --ink:#e5e7eb; --muted:#94a3b8; --line:#1f2937;
      --brand:#60a5fa; --accent:#1d4ed8; --warn:#f59e0b; --ok:#22c55e;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#0b1024,#0f172a);color:var(--ink)}
    header{padding:28px 16px;text-align:center}
    h1{margin:0 0 6px;font-size:24px}
    .hint{color:var(--muted);font-size:13px}
    .wrap{max-width:1100px;margin:0 auto;padding:0 16px 60px}
    .panel{background:rgba(11,18,32,.9);backdrop-filter:saturate(140%) blur(6px);border:1px solid var(--line);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;padding:12px;border-bottom:1px solid var(--line)}
    input[type="text"]{flex:1;min-width:220px;padding:11px 12px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:var(--ink)}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:var(--ink);cursor:pointer}
    .btn.primary{background:var(--accent);border-color:#2563eb}
    .tabs{display:flex;gap:8px;margin-right:auto}
    .tab{padding:8px 12px;border-radius:999px;border:1px solid #334155;cursor:pointer;background:#0b1220;color:var(--ink);font-weight:600}
    .tab.active{background:var(--accent);border-color:#2563eb}
    .status{margin-left:auto;display:flex;align-items:center;gap:8px}
    .badge{font-size:12px;border:1px solid #334155;border-radius:999px;padding:2px 8px;color:#93c5fd;background:#0b1220}
    .meta{display:flex;justify-content:space-between;gap:12px;padding:10px 14px;border-bottom:1px solid var(--line);color:var(--muted);font-size:13px}
    .section{padding:14px}
    .result{display:grid;grid-template-columns: 220px 1fr;gap:8px;border:1px solid var(--line);border-radius:12px;padding:12px;background:#0b1220}
    .k{color:#93c5fd}
    .v{color:var(--ink)}
    .list{display:flex;flex-direction:column;gap:10px}
    .msg{padding:12px;border:1px dashed #334155;border-radius:10px;color:var(--muted);background:#0b1220}
    .grid{width:100%;border-collapse:separate;border-spacing:0}
    th{position:sticky;top:0;text-align:left;background:#0b1220;color:#93c5fd;border-bottom:1px solid var(--line);padding:8px}
    td{border-bottom:1px dashed #1f2937;padding:8px;vertical-align:top}
    mark{background:transparent;color:#facc15}
    .small{font-size:12px;color:var(--muted)}
    footer{padding:20px;text-align:center;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <header>
    <h1>Part Cross‑Reference</h1>
    <div class="hint">Two functions: <b>OLD → NEW</b> and <b>NEW → OLD</b>. Add a <code>parts.csv</code> with headers: <code>Part#,Part#(formatted),Product#,Product Line,Status,Standard,Non Standard,Sample,Details 1,Details 2</code>.</div>
  </header>

  <div class="wrap">
    <div class="panel" id="app">

      <div class="toolbar">
        <div class="tabs">
          <button class="tab active" id="tab-oldnew">OLD → NEW</button>
          <button class="tab" id="tab-newold">NEW → OLD</button>
        </div>

        <input id="q" type="text" placeholder="Enter part number…" autocomplete="off" />
        <button id="search" class="btn primary">Search</button>

        <div class="status">
          <span id="badge" class="badge">Loading…</span>
          <input id="file" type="file" accept=".csv" class="btn" title="Load CSV">
        </div>
      </div>

      <div class="meta">
        <div>Rows: <span id="rowCount">0</span></div>
        <div>Mode: <b id="modeName">OLD → NEW</b> • Normalized input: <code id="normPreview">—</code></div>
      </div>

      <div class="section">
        <div id="results"></div>
      </div>

    </div>
    <footer>Client‑side only. Host for free on GitHub Pages (drop <code>index.html</code> + <code>parts.csv</code>).</footer>
  </div>

<script>
const COLS = ["Part#","Part#(formatted)","Product#","Product Line","Status","Standard","Non Standard","Sample","Details 1","Details 2"];

function normalize(s){
  return String(s||"").replace(/[^A-Za-z0-9]/g,"").toUpperCase();
}

function parseCSV(text){
  const lines = text.replace(/\r/g,'').split('\n').filter(l => l.length>0);
  const header = lines.shift().split(',').map(h=>h.trim());
  const rows = lines.map(line => {
    const parts = line.split(',');
    const o = {};
    header.forEach((h,i)=>{ o[h] = (parts[i]||'').trim(); });
    return o;
  });
  return {header, rows};
}

function el(tag, attrs={}, html=""){
  const e = document.createElement(tag);
  Object.entries(attrs).forEach(([k,v]) => e.setAttribute(k,v));
  e.innerHTML = html;
  return e;
}

function setBadge(msg){ document.getElementById('badge').textContent = msg; }
function showMessage(container, text){ container.innerHTML = `<div class="msg">${text}</div>`; }

const STATE = {
  mode: 'OLDNEW',
  rows: [],
  mapByFormatted: new Map(),
  mapByStandard: new Map(),
};

function indexData(){
  STATE.mapByFormatted = new Map();
  STATE.mapByStandard = new Map();
  for(const r of STATE.rows){
    const fmt = normalize(r["Part#(formatted)"]);
    if(fmt){
      if(!STATE.mapByFormatted.has(fmt)) STATE.mapByFormatted.set(fmt, []);
      STATE.mapByFormatted.get(fmt).push(r);
    }
    const std = normalize(r["Standard"]);
    if(std){
      if(!STATE.mapByStandard.has(std)) STATE.mapByStandard.set(std, []);
      STATE.mapByStandard.get(std).push(r);
    }
  }
}

function loadCSVText(text){
  const {header, rows} = parseCSV(text);
  const missing = COLS.filter(c => !header.includes(c));
  if(missing.length){ setBadge('Bad headers: ' + missing.join(', ')); } else { setBadge('Ready'); }
  STATE.rows = rows;
  indexData();
  document.getElementById('rowCount').textContent = String(rows.length);
  document.getElementById('results').innerHTML = '';
}

function renderOldToNew(container, inputRaw){
  const norm = normalize(inputRaw);
  document.getElementById('normPreview').textContent = norm || '—';
  if(!norm){ showMessage(container, 'Enter an old part number to search.'); return; }

  const hits = STATE.mapByFormatted.get(norm) || [];
  if(hits.length === 0){ showMessage(container, `No results for “${inputRaw}”. (normalized: ${norm})`); return; }

  const list = el('div', {class:'list'});
  hits.forEach((r)=>{
    const status = String(r["Status"]||'').trim();
    const isStandard = status.toLowerCase() === 'standard';
    const isSP = status.toUpperCase() === 'SP';

    let body = '';
    if(isStandard){
      body = `
        <div class="k">Status</div><div class="v"><b>${r["Status"]||""}</b></div>
        <div class="k">New Part (Standard)</div><div class="v"><code>${r["Standard"]||""}</code></div>
        <div class="k">Details 1</div><div class="v">${r["Details 1"]||""}</div>
        <div class="k">Details 2</div><div class="v">${r["Details 2"]||""}</div>`;
    }else if(isSP){
      body = `
        <div class="k">Status</div><div class="v"><b>${r["Status"]||""}</b></div>
        <div class="k">Non Standard Info</div><div class="v">${r["Non Standard"]||""}</div>
        <div class="k">Sample</div><div class="v">${r["Sample"]||""}</div>
        <div class="k">Details 1</div><div class="v">${r["Details 1"]||""}</div>
        <div class="k">Details 2</div><div class="v">${r["Details 2"]||""}</div>`;
    }else{
      body = `
        <div class="k">Status</div><div class="v"><b>${r["Status"]||""}</b></div>
        <div class="k">Details 1</div><div class="v">${r["Details 1"]||""}</div>
        <div class="k">Details 2</div><div class="v">${r["Details 2"]||""}</div>
        <div class="k"></div><div class="v small">No specific Standard/SP rule matched for this status.</div>`;
    }

    const card = el('div', {class:'result'}, `
      <div class="k">Old Part#</div><div class="v"><code>${r["Part#"]||""}</code></div>
      <div class="k">Formatted</div><div class="v"><code>${r["Part#(formatted)"]||""}</code></div>
      <div class="k">Product#</div><div class="v">${r["Product#"]||""}</div>
      <div class="k">Product Line</div><div class="v">${r["Product Line"]||""}</div>
      ${body}`);
    list.appendChild(card);
  });
  container.innerHTML = '';
  container.appendChild(list);
}

function renderNewToOld(container, inputRaw){
  const norm = normalize(inputRaw);
  document.getElementById('normPreview').textContent = norm || '—';
  if(!norm){ showMessage(container, 'Enter a new/standard part number to search.'); return; }

  const rows = STATE.mapByStandard.get(norm) || [];
  if(rows.length === 0){ showMessage(container, 'NEW configuration'); return; }

  const uniques = new Map();
  for(const r of rows){
    const key = String(r["Part#"]||"");
    if(!uniques.has(key)){
      uniques.set(key, {part: key, status: r["Status"]||"", d1: r["Details 1"]||"", d2: r["Details 2"]||""});
    }
  }
  const data = Array.from(uniques.values());

  const table = el('table', {class:'grid'});
  table.innerHTML = `
    <thead><tr><th>Old Part#</th><th>Status</th><th>Details 1</th><th>Details 2</th></tr></thead>
    <tbody>
      ${data.map(r=>`<tr><td><code>${r.part}</code></td><td>${r.status}</td><td>${r.d1}</td><td>${r.d2}</td></tr>`).join('')}
    </tbody>`;
  container.innerHTML = '';
  container.appendChild(table);
}

const els = {
  tabOldNew: document.getElementById('tab-oldnew'),
  tabNewOld: document.getElementById('tab-newold'),
  q: document.getElementById('q'),
  search: document.getElementById('search'),
  results: document.getElementById('results'),
  modeName: document.getElementById('modeName'),
  normPreview: document.getElementById('normPreview'),
  rowCount: document.getElementById('rowCount'),
  file: document.getElementById('file'),
};

function setMode(m){
  STATE.mode = m;
  els.modeName.textContent = (m==='OLDNEW') ? 'OLD → NEW' : 'NEW → OLD';
  document.getElementById('tab-oldnew').classList.toggle('active', m==='OLDNEW');
  document.getElementById('tab-newold').classList.toggle('active', m==='NEWOLD');
  els.results.innerHTML = '';
}

els.tabOldNew.addEventListener('click', ()=> setMode('OLDNEW'));
els.tabNewOld.addEventListener('click', ()=> setMode('NEWOLD'));
els.search.addEventListener('click', ()=>{
  const val = els.q.value;
  if(STATE.mode==='OLDNEW') renderOldToNew(els.results, val);
  else renderNewToOld(els.results, val);
});
els.q.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ els.search.click(); } });

els.file.addEventListener('change', (e)=>{
  const f = e.target.files?.[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=> loadCSVText(String(reader.result||''));
  reader.readAsText(f);
});

async function init(){
  try{
    const res = await fetch('parts.csv');
    if(res.ok){
      loadCSVText(await res.text());
      setBadge('Ready');
      return;
    }
    throw new Error('missing parts.csv');
  }catch{
    setBadge('Demo data');
    const demo = `Part#,Part#(formatted),Product#,Product Line,Status,Standard,Non Standard,Sample,Details 1,Details 2
ABC-100,ABC100,P-100,Line A,Standard,STD-100,,SAMP-5,Pressure switch,1/4 NPT
ABC-101,ABC101,P-100,Line A,SP,,Needs ENG review,SAMP-6,Pressure switch,3/8 NPT
XYZ-555,XYZ555,P-555,Line B,Standard,CTL2,,SAMP-7,Controller board,v2
12345-ABC,12345ABC,P-12345,Line C,Obsolete,,,SAMP-8,Valve kit,3/8`;
    loadCSVText(demo);
  }
}
init();
</script>
</body>
</html>
